let allowed_protocols = [ "HTTPS", "TLS" ]

let elbs = Resources.*[ Type == 'AWS::ElasticLoadBalancingV2::Listener' ]
rule ensure_all_elbs_are_secure when %elbs !empty {
    %elbs.Properties.Protocol in %allowed_protocols
    %elbs.Properties.Certificates exists
    %elbs.Properties.Certificates !empty
}

rule ensure_elbs_are_internal {
    ensure_all_elbs_are_secure
    %elbs.Properties.Scheme == 'internal'
}
